var CCC=CCC||{};(function($){CCC.favorite={toggle_btn:"ccc-favorite-post-toggle-button",toggle_btn_elm:$(".ccc-favorite-post-toggle-button"),delete_btn:"ccc-favorite-post-delete-button",count_elm:$(".ccc-favorite-post-count"),num_elm:$(".num"),save_classname:"save",active_classname:"active",data_key:"post_id-ccc_favorite",storage_key:function(){var key="ccc-my_favorite_post";return key;},initial:function(favorite_value){if(favorite_value!==null){var favorite_value_array=favorite_value.split(",");favorite_value_array=favorite_value_array.filter(function(v){return!(v===null||v===undefined||v==="");});CCC.favorite.count_elm.find(CCC.favorite.num_elm).text(favorite_value_array.length);if(favorite_value_array.length>0){CCC.favorite.count_elm.addClass(CCC.favorite.active_classname);}else{CCC.favorite.count_elm.removeClass(CCC.favorite.active_classname);}
$("."+CCC.favorite.toggle_btn).each(function(){var post_id=$(this).data(CCC.favorite.data_key);var value_index=favorite_value_array.indexOf(String(post_id));if(value_index===-1){$(this).removeClass(CCC.favorite.save_classname);}else{$(this).addClass(CCC.favorite.save_classname);}});}},action:function(favorite_key,favorite_value){function my_favorite_toggle(this_elm){var post_id=this_elm.data(CCC.favorite.data_key);this_elm.toggleClass(CCC.favorite.save_classname);if(favorite_value===null){var favorite_value_array=[];favorite_value_array.unshift(post_id);}else{var favorite_value_array=favorite_value.split(",");var value_index=favorite_value_array.indexOf(String(post_id));if(value_index===-1){favorite_value_array.unshift(post_id);}else{favorite_value_array.splice(value_index,1);}}
favorite_value_array=favorite_value_array.filter(function(v){return!(v===null||v===undefined||v==="");});if(favorite_value_array.length>300){favorite_value_array=favorite_value_array.slice(0,300);}
favorite_value_array_str=favorite_value_array.join(",");if(CCC_MY_FAVORITE_UPDATE.user_logged_in==false){localStorage.setItem(favorite_key,favorite_value_array_str);}
CCC.favorite.count_elm.find(CCC.favorite.num_elm).text(favorite_value_array.length);if(favorite_value_array.length>0){CCC.favorite.count_elm.addClass(CCC.favorite.active_classname);}else{CCC.favorite.count_elm.removeClass(CCC.favorite.active_classname);}}
function my_favorite_update_ajax(value){$.ajax({url:CCC_MY_FAVORITE_UPDATE.api,type:"POST",data:{action:CCC_MY_FAVORITE_UPDATE.action,nonce:CCC_MY_FAVORITE_UPDATE.nonce,post_ids:value,},}).fail(function(){console.log("ccc_my_favorite_update : ajax error");}).done(function(response){});}
$(document).on("click","."+CCC.favorite.toggle_btn,function(e){e.preventDefault();var this_elm=$(this);if(CCC_MY_FAVORITE_UPDATE.user_logged_in==false){favorite_value=localStorage.getItem(favorite_key);my_favorite_toggle(this_elm);}else{$.ajax({url:CCC_MY_FAVORITE_GET.api,type:"POST",data:{action:CCC_MY_FAVORITE_GET.action,nonce:CCC_MY_FAVORITE_GET.nonce,},}).fail(function(){console.log("ccc_my_favorite_get : ajax error");}).done(function(response){favorite_value=response;my_favorite_toggle(this_elm);my_favorite_update_ajax(favorite_value_array_str);});}});$(document).on("click","."+CCC.favorite.delete_btn,function(e){e.preventDefault();if(CCC_MY_FAVORITE_UPDATE.user_logged_in==false){localStorage.removeItem(favorite_key);}else{my_favorite_update_ajax("");}
CCC.favorite.count_elm.find(CCC.favorite.num_elm).text(0);CCC.favorite.count_elm.removeClass(CCC.favorite.active_classname);CCC.favorite.toggle_btn_elm.removeClass(CCC.favorite.save_classname);});},};if(CCC_MY_FAVORITE_UPDATE.user_logged_in==false){var favorite_key=CCC.favorite.storage_key();var favorite_value=localStorage.getItem(favorite_key);CCC.favorite.initial(favorite_value);CCC.favorite.action(favorite_key,favorite_value);}else{$.ajax({url:CCC_MY_FAVORITE_GET.api,type:"POST",data:{action:CCC_MY_FAVORITE_GET.action,nonce:CCC_MY_FAVORITE_GET.nonce,},}).fail(function(){console.log("my_favorite_get : ajax error");}).done(function(response){var favorite_key="";var favorite_value=response;CCC.favorite.initial(favorite_value);CCC.favorite.action(favorite_key,favorite_value);});}})(jQuery);